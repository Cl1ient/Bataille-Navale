@startuml
skinparam linetype ortho
skinparam nodesep 50
skinparam ranksep 50

package model {
    class Game
    class Player
    class Coordinate
    class Trap
    class EntityType
    class BoatType
    class Cell
    class ScanResult
    class GameConfiguration
}


package controller {
    class GameController {
        - m_game : Game
        - m_gameConfig : GameConfiguration
        - m_boatsToPlace : Map<EntityType, Integer>
        - m_currentWeaponMode : String
        - m_trapToPlace : Trap
        - m_configView : ConfigView
        - m_placementView : PlacementView
        - m_gameView : GameView

        + <<create>> GameController()
        + setGameConfig(config : GameConfiguration)
        + setBoatsToPlace(boatsToPlace : Map<EntityType, Integer>)
        + setWeaponMode(mode : String)
        + callPlaceEntityView()
        + startGame(humanPlacement : Map<EntityType, List<Coordinate>>)
        + handleHumanAttack(x : int, y : int)
        + handlePlaceTrap(trap : Trap, coord : Coordinate) : Boolean
        - triggerComputerTurn()
        - playComputerTurn()
        - canUseSonar(player : Player) : boolean
        + getGameConfiguration() : GameConfiguration
        + restartGame()
    }
}

package view {

    class ConfigView {
        - controller : GameController
        - txtNickname : JTextField
        - cbGridSize : JComboBox<Integer>
        - chkIslandMode : JCheckBox
        - cbPlacementLevel : JComboBox<Integer>
        - lblTotalCells : JLabel
        - boatSpinners : Map<BoatType, JSpinner>

        - MIN_BOATS : Integer
        - MAX_BOATS : Integer
        - MAX_TOTAL_CELLS : Integer
        - BOAT_SIZES : Map<EntityType, Integer>

        + <<create>> ConfigView(controller : GameController)
        - createSettingsPanel() : JPanel
        - updateTotalCellCount()
        - calculateTotalShipCells() : int
        - createConfigurationObject() : GameConfiguration
        - getRequestedBoatCounts() : Map<EntityType, Integer>
        - validateConfiguration(config : GameConfiguration) : boolean
        - onNextStepClicked(event : ActionEvent)
        + showScreen()
    }

    package gameView {

        class GameLogPanel {
            - m_logArea : JTextArea
            - m_timeFormat : SimpleDateFormat
            + <<create>> GameLogPanel()
            + addLog(message : String)
            + addLog(message : String, isImportant : boolean)
        }

        class GameView {
            - m_controller : GameController
            - m_game : Game
            - m_playerGridPanel : GridPanel
            - m_opponentGridPanel : GridPanel
            - m_infoPanel : InfoPanel
            - m_weaponPanel : WeaponPanel
            - m_statusLabel : JLabel
            - m_logPanel : GameLogPanel
            - m_pendingTrapToPlace : Trap

            + <<create>> GameView(controller : GameController, game : Game)
            - wrapGrid(grid : GridPanel, title : String) : JPanel
            - onPlayerGridClick(coord : Coordinate)
            - onOpponentGridClick(coord : Coordinate)
            + showScreen()
            + setStatus(text : String)
            + updateGrids()
            + setInputEnabled(enabled : boolean)

            ' Implementation GameListener
            + turnEnded(player : Player, moves : Map<Coordinate, String>)
            + onCellUpdated(p : Player, c : Coordinate)
            + onShipSunk(defender : Player)
            + onGameOver(winner : Player)
            + onScanResult(player : Player, scannedArea : List<Coordinate>, results : List<ScanResult>)
            + onBlackHolHit(defender : Player)
            + onStormHit(attacker : Player)

            ' Implementation IslandListener
            + notifyPlaceIslandEntity(entity : Trap, player : Player)
            + notifyTrapWrongPlacement()
            + notifyWeaponFind(weaponType : EntityType)
        }

        class GridPanel {
            - m_gridModel : Grid
            - m_isIslandMode : boolean
            - m_gridSize : int
            - m_cellsUI : JPanel[][]
            - onClickAction : Consumer<Coordinate>
            - inputEnabled : boolean

            + <<create>> GridPanel(gridModel : Grid, isIslandMode : boolean, onClickAction : Consumer<Coordinate>)
            - initializeGrid()
            - createCell(row : int, col : int) : JPanel
            + updateGridDisplay(showUnvisitedShips : boolean)
            - getCellColor(cell : Cell, r : int, c : int, showShips : boolean) : Color
            + setInputEnabled(enabled : boolean)
        }

        class InfoPanel {
            - m_game : Game
            - m_parentFrame : Component

            + <<create>> InfoPanel(game : Game, parentFrame : Component)
            + updateStats()
            - createPlayerStats(target : Player, opponent : Player) : JPanel
            - showHistory()
        }

        class WeaponPanel {
            + <<create>> WeaponPanel(controller : GameController)
            - addWeaponOption(label : String, tooltip : String, mode : String, selected : boolean, group : ButtonGroup, controller : GameController)
        }
    }

    package placementView {
        class PlacementControlPanel {
            - m_parentView : PlacementView
            - m_cbEntitySelector : JComboBox<EntityType>
            - m_chkOrientation : JCheckBox
            - m_btnValidate : JButton
            - m_btnRandom : JButton
            - m_lblInstruction : JLabel

            + <<create>> PlacementControlPanel(parentView : PlacementView)
            + updateControls(model : PlacementModel)
        }

        class PlacementGridPanel {
            - m_parentView : PlacementView
            - m_gridSize : int
            - m_cells : JPanel[][]

            + <<create>> PlacementGridPanel(parentView : PlacementView, gridSize : int)
            - initGrid()
            - createCell(r : int, c : int) : JPanel
            + updateDisplay(model : PlacementModel, previewCoords : List<Coordinate>, previewValid : boolean)
            - getEntityColor(type : EntityType) : Color
        }

        class PlacementModel {
            - m_gridSize : int
            - m_islandMode : boolean
            - m_boatsToPlace : Map<EntityType, Integer>
            - m_placedEntities : Map<EntityType, List<Coordinate>>
            - m_selectedEntityType : EntityType
            - m_isHorizontal : boolean

            + <<create>> PlacementModel(controller : GameController, boatsToPlace : Map<EntityType, Integer>)
            + validatePlacement(coords : List<Coordinate>) : boolean
            + placeEntity(coords : List<Coordinate>)
            - isOccupied(coord : Coordinate) : boolean
            + calculateCoordinates(r : int, c : int) : List<Coordinate>
            - getEntitySize(type : EntityType) : int
            + updateSelectionAuto()
            + getAvailableTypes() : List<EntityType>
            - decrementBoatCount(type : EntityType)
            + isFinished() : boolean
            + getRemainingCount() : int
            + getPlacedEntityTypeAt(r : int, c : int) : EntityType
            + {static} isBoat(type : EntityType) : boolean
            + placeAllRandomly()

            ' Getters & Setters
            + setSelectedEntityType(type : EntityType)
            + getSelectedEntityType() : EntityType
            + setHorizontal(horizontal : boolean)
            + getPlacedEntities() : Map<EntityType, List<Coordinate>>
            + getGridSize() : int
            + isIslandMode() : boolean
        }

        class PlacementView {
            - m_controller : GameController
            - m_model : PlacementModel
            - m_controlPanel : PlacementControlPanel
            - m_gridPanel : PlacementGridPanel
            - m_statusLabel : JLabel

            + <<create>> PlacementView(controller : GameController, gridSize : int, boatsToPlace : Map<EntityType, Integer>)
            + onHover(row : int, col : int)
            + onClick(row : int, col : int)
            + onValidate()
            + refreshGrid()
            - updateUIState()
            - updateStatusLabel()
            + getModel() : PlacementModel
            + onRandomPlacement()
            + showScreen()
        }
    }
}

GameController --> Game
GameController --> GameConfiguration

GameController --> ConfigView : <<creates>>
GameController --> PlacementView : <<creates>>
GameController --> GameView : <<creates>>

ConfigView --> GameController : <<uses>>
ConfigView ..> GameConfiguration : <<creates>>
ConfigView ..> BoatType : <<uses>>
ConfigView ..> EntityType : <<uses>>

GameView "1" *--> "1" WeaponPanel : contains
GameView "1" *--> "1" InfoPanel : contains
GameView "1" *--> "2" GridPanel : contains
GameView "1" *--> "1" GameLogPanel : contains
GameView --> GameController : <<uses>>
GameView --> Game : <<observes>>
GameView ..> Trap : <<uses>>

InfoPanel --> Game : <<uses>>
InfoPanel ..> Player : <<uses>>
WeaponPanel --> GameController : <<uses>>
GridPanel ..> Cell : <<uses>>

PlacementView --> GameController : <<uses>>
PlacementView *--> PlacementModel
PlacementView *--> PlacementControlPanel
PlacementView *--> PlacementGridPanel
PlacementView ..> Coordinate : <<uses>>
PlacementView ..> EntityType : <<uses>>

PlacementModel ..> GameController : <<uses>>
PlacementModel ..> Coordinate : <<uses>>
PlacementModel ..> EntityType : <<uses>>

PlacementControlPanel --> PlacementView : <<uses>>
PlacementControlPanel ..> PlacementModel : <<uses>>
PlacementGridPanel --> PlacementView : <<uses>>
PlacementGridPanel ..> PlacementModel : <<uses>>

@enduml